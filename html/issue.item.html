{% extends 'layout/page.html' %}

{% block head_title %}
  {% if context.id %}
    Issue {{ context.id }}: {{ context.title.plain()|u }} - {{ config.TRACKER_NAME }}
  {% else %}
    New Issue - {{ config.TRACKER_NAME }}
  {% endif %}
{% endblock %}

{% block page_header %}
  {% if not (context.id or context.is_edit_ok()) %}
    New Issue
  {% elif not context.id and context.is_edit_ok() %}
    New Issue Editing
  {% else %}
    Issue {{ context.id }}
  {% endif %}
{% endblock %}

{% block content %}

  {% include 'layout/permission.html' %}

  {% if context.is_view_ok() %}
    {% if context.is_edit_ok() %}
      {% include 'issue.item.edit.html' %}
    {% else %}
      {% include 'issue.item.readonly.html' %}
    {% endif %}
  {% endif %}

  {% if context.id %}
    <p>
      Created on <b>{{ context.creation.plain()|u }}</b>
      by <b>{{ context.creator.plain()|u }}</b>,
      last changed <b>{{ context.activity.reldate()|u }}</b>
      by <b>{{ context.actor.plain()|u }}</b>.
    </p>
  {% endif %}

  {% if context.files %}
    {% include 'file.index.html' %}
  {% endif %}

  {% if context.messages %}
    <h4>Messages</h4>
    {% for msg in context.messages.reverse() %}
      <div class="row row-cols-1 row-cols-lg-3">
        <div class="col col-lg-auto">
          <a href='msg{{ msg.id }}'>msg{{msg.id}} (view)</a>
        </div>
        <div class="col col-lg-auto">
          Author: {{ msg.author.plain()|u }}, Date: {{ msg.date.plain()|u }}
        </div>
        <div class="col col-lg-auto">
          {% if context.is_edit_ok %}
            <form method="POST" action='issue{{ context.id }}' class='form-inline'>
              <input type="hidden" name="@remove@messages" value='{{ msg.id }}'>
              <input name="@csrf" type="hidden"
                     value="{{ utils.anti_csrf_nonce() }}">
              <input type="hidden" name="@action" value="edit">
              <input type="submit" value="remove">
            </form>
          {% endif %}
        </div>
      </div>
      <div>
        <pre>{{ msg.content.hyperlinked()|u|safe }}</pre>
      </div>
    {% endfor %}
  {% endif %}

  <div class='vspace-five'></div>

  {{ context.history()|u|safe }}

{% endblock %}
